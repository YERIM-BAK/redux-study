<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<script src="https://unpkg.com/redux@4.2.1/dist/redux.min.js"></script>
</head>

<body>
	<ul id="todo-list"></ul>

	<div>
		<input type="text" id="input-text" />
		<button id="add-button">할 일 추가</button>
		<button id="remove-button">할 일 삭제</button>
		<button id="remove-all-button">모두 삭제</button>
		<button id="logging-state">State Logging</button>
	</div>

	<script>
		const ACTION_TYPE_ADD_TODO = "ADD_TODO";
		const ACTION_TYPE_REMOVE_TODO = "REMOVE_TODO";
		const ACTION_TYPE_REMOVE_ALL = "REMOVE_ALL";

		function todoReducer(state, action) {
			switch (action.type) {
				case ACTION_TYPE_ADD_TODO:
					return state.concat(action.text);
				case ACTION_TYPE_REMOVE_TODO:
					return state.slice(0, -1);
				case ACTION_TYPE_REMOVE_ALL:
						return [];
				default:
					return state;
			}
		}

		function loggerMiddleware({ getState }) {
			return (next) => (action) => {
				console.log("dispatch 예정 action", action);

				const returnVlaue = next(action);

				console.log("dispatch 이후 state", getState());

				return returnVlaue;
			};
		}

		let store = Redux.createStore(
			todoReducer, ["처음 만난 리덕스 공부하기"],
			Redux.applyMiddleware(loggerMiddleware)
		);

		let todoListElem = document.getElementById("todo-list");
		let inputElem = document.getElementById("input-text");

		function render() {
			todoListElem.innerHTML = "";

			store.getState().forEach((todo) => {
				const todoListItemElem = document.createElement("li");
				todoListItemElem.textContent = todo;
				todoListElem.appendChild(todoListItemElem);
			})
		}

		render();
		store.subscribe(render);

		function addTodoActionCreator(text) {
			return {
				type: ACTION_TYPE_ADD_TODO,
				text: text,
			}
		}
		function removeTodoActionCreator() {
			return {
				type: ACTION_TYPE_REMOVE_TODO,
			}
		}
		function removeAllTodoActionCreator() {
			return {
				type: ACTION_TYPE_REMOVE_ALL,
			}
		}

		document.getElementById("add-button").addEventListener("click", function () {
			store.dispatch(addTodoActionCreator(inputElem.value));
			inputElem.value = "";
		});

		document.getElementById("remove-button").addEventListener("click", function() {
			store.dispatch(removeTodoActionCreator());
		});

		document.getElementById("remove-all-button").addEventListener("click", function() {
			store.dispatch(removeAllTodoActionCreator());
		});

		document.getElementById("logging-state").addEventListener("click", function () {
			console.log("현재 state", store.getState());
		})
	</script>
</body>

</html>